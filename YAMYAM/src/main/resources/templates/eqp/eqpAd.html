<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/layout}">

<div class="container" layout:fragment="content">
	<h3>설비 관리</h3>
	<div>
		<!-- 탭 목록 start -->
		<ul class="nav nav-tabs nav-pills" id="myTab" role="tablist">
			<li class="nav-item" role="presentation">
				<button class="nav-link active" id="select-tab" data-bs-toggle="tab"
					data-bs-target="#select" type="button" role="tab"
					aria-controls="select" aria-selected="true">조회</button>
			</li>
			<li class="nav-item" role="presentation">
				<button class="nav-link" id="manage-tab" data-bs-toggle="tab"
					data-bs-target="#manage" type="button" role="tab"
					aria-controls="manage" aria-selected="false">관리</button>
			</li>
		</ul>
		<!-- 탭 목록 end -->
		
		<!-- 탭 본문 -->
		<div class="tab-content" id="myTabContent" style="border: 1px solid black;">
			
			<!-- 조회탭 본문 start -->
			<div class="tab-pane fade show active" id="select" role="tabpanel"
				aria-labelledby="select-tab">
				<div style="margin-top:10px">
					<form action="#">
						<ul class="ul-style">
							<li>
								<label for="eName">설비명</label>
								<input type="text" name="eName" id="firstEName">
								<button type="button" class="btn btn-dark btn-sm" id="searchBtn">검색</button>
								<input type="reset" class="btn btn-dark btn-sm">
								<button type="button" class="btn btn-dark btn-sm me-md-2" style="float:right" id="deleteBtn">삭제</button>
							</li>
						</ul>
					</form>
					<!-- 조회 grid -->
					<div id="selectEqp"></div>
				</div>
			</div>
			<!-- 조회탭 본문 end -->
			
			<!-- 관리탭 본문 start -->
			<div class="tab-pane fade" id="manage" role="tabpanel"
				aria-labelledby="manage-tab">
				<form action="#">
					<div style="margin: 15px;">
						<div class="d-md-flex justify-content-md-end">
							<button type="button" class="btn btn-dark btn-sm me-md-2" data-bs-toggle="modal"
												data-bs-target="#eqpListModal">설비 목록</button>
							<input type="reset" class="btn btn-dark btn-sm me-md-2">
							<button type="button" class="btn btn-dark btn-sm me-md-2" id="insertUpdateBtn">저장</button>
						</div>
						
						<hr style="height:3px;">
						
						<!-- 테이블과 사진 배치 start -->
						<div class="row">
							<div class="col-9">
								<table id="eqpTable">
									<tr>
										<th>설비코드</th>
										<td>
											<input type="text" id="eqpCd" name="eqpCd">
										</td>
										<th>설비업체명</th>
										<td>
											<input type="text" id="sal" name="sal">
										</td>
										<th>사용여부</th>
										<td>
											<input type="radio" id="sts" name="sts" value="" /> 가동 &nbsp;
											<input type="radio" id="sts" name="sts" value="" /> 비가동 &nbsp; 
											<input type="radio" id="sts" name="sts" value="" /> 대기 &nbsp;
										</td>
									</tr>
									<tr>
										<th>설비명</th>
										<td>
											<input type="text" id="secondEName" name="eName">
										</td>
										<th>제작일자</th>
										<td>
											<input type="text" id="mDate" name="mDate">
										</td>
										<th>UPH</th>
										<td>
											<input type="text" id="uph" name="uph">
										</td>
									</tr>
									<tr>
										<th>모델명</th>
										<td>
											<input type="text" id="mName" name="mName">
										</td>
										<th>구매일자</th>
										<td>
											<input type="text" id="bDate" name="bDate">
										</td>
										<th>온도</th>
										<td>
											<input type="text" id="actCd" name="actCd" style="margin-right: 0; width: 90px;"> - 
											<input type="text" id="actCd" name="actCd" style="width: 90px; margin-right: 0;"> ℃
										</td>
									</tr>
									<tr>
										<th>점검주기</th>
										<td>
											<input type="text" id="cCycle" name="cCycle">
										</td>
										<th>설비구분</th>
										<td colspan="2">
											<input type="text" id="eqpTypeCode" name="eqpTypeCode" style="margin-right: 0;" readonly>
											<img class="Magnifying-Glass-img" alt="image" data-bs-toggle="modal"
												data-bs-target="#eqpTypeModal" src="../images/Magnifying_Glass.png">
											<input type="text" id="eqpTypeName" name="eqpTypeName" readonly>
										</td>
									</tr>
								</table>
							</div>
							<div class="col-3">
								<img id="img" name="img" alt="설비사진" src="images/main.png" width="300px" height="300px">
							</div>
						</div>
						<!-- 테이블과 사진 배치 end -->
					</div>
				</form>
			</div>
			<!-- 관리탭 본문 end -->
		</div>
		<!-- 탭 본문 end -->
	</div>
	
	<!-- 설비목록 modal -->
	<div class="modal" id="eqpListModal" tabindex="-1"
		aria-labelledby="#eqpListLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="eqpListLabel">설비 목록</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div id="eqpListModalGrid"></div>
				</div>

			</div>
		</div>
	</div>
	
	<!-- 설비구분 modal -->
	<div class="modal" id="eqpTypeModal" tabindex="-1"
		aria-labelledby="#eqpTypeLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="eqpTypeLabel">설비 구분</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<div id="eqpTypeModalGrid"></div>
				</div>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		let selectEqpGrid = selectTabInit(); 		// 조회탭 그리드 초기화
		let eqpListModalGrid = eqpListModalInit();	// 관리탭 설비목록 모달 그리드 초기화
		let eqpTypeModalGrid = eqpTypeModalInit();	// 관리탭 설비구분 모달 그리드 초기화
		
		searchBtn();								// 조회탭 검색버튼
		deleteBtn();								// 조회탭 선택 삭제 버튼
		
		eqpTypeSelect();							// 관리탭 설비구분 선택 모달창 refresh
		eqpListSelect();							// 관리탭 설비목록 모달 조회 
		insertUpdateBtn();							// 관리탭 form태그 내용으로 insert OR update 하는 버튼
		eqpTypeInsertInput();						// 관리탭 설비구분 돋보기 모달에서 하나 클릭시, 설비구분 input태그에 값 넣어주고 모달창 닫기
		eqpListInsertInput();						// 관리탭 설비목록 모달에서 하나 클릭시, 설비전체 input태그에 값 넣어주고 모달창 닫기
		
		
		/* ---------------
		조회탭 그리드
		--------------- */
		function selectTabInit() {
		
			let selectEqpGrid = new tui.Grid({
			      el: document.getElementById('selectEqp'),
			      bodyHeight: 500, // 스크롤
			      data: [
			    	{
				    	eqpCd: 'eqp-20221104-001',
				    	eName: '만두소 배합기',
				    	mName: 'mandu-01',
				    	actCD: 'ACT-010',
				    	name: '최고배합기',
				    	sal: 2000000,
				    	mDate: '2022-11-01',
				    	bDate: '2022-11-14',
				    	cCycle: 60,
				    	dates: '2022-11-14',
				    	sts: '대기'
				    },
				    {
				    	eqpCd: 'eqp-20221104-002',
				    	eName: '만두소 배합기2',
				    	mName: 'mandu-02',
				    	actCD: 'ACT-010',
				    	name: '최고배합기',
				    	sal: 2000000,
				    	mDate: '2022-11-01',
				    	bDate: '2022-11-14',
				    	cCycle: 60,
				    	dates: '2022-11-14',
				    	sts: '가동'
				    }
				  ],
			      rowHeaders: ['checkbox'],
			      scrollX: false,
			      scrollY: true,
			      columns: [
			        {
			          header: '설비코드',
			          name: 'eqpCd',
				      sortable: true,
				      align: 'center'
			        },
			        {
			          header: '설비명',
			          name: 'eName',
				      sortable: true,
				      align: 'left'
			        },
			        {
			          header: '모델명',
			          name: 'mName',
				      sortable: true,
				      align: 'center'
			        },
			        {
			          header: '거래처코드',
			          name: 'actCD',
				      sortable: true,
				      align: 'center'
			          
			        },
			        {
			          header: '설비업체명',
			          name: 'name',
				      sortable: true,
				      align: 'left'
			        },
			        {
			          header: '금액',
			          name: 'sal',
				      sortable: true,
				      align: 'right'
			        },
			        {
			          header: '제작일자',
			          name: 'mDate',
				      sortable: true,
				      align: 'center'
			        },
			        {
			          header: '구매일자',
			          name: 'bDate',
				      sortable: true,
				      align: 'center'
			        },
			        {
			          header: '점검주기',
			          name: 'cCycle',
				      sortable: true,
				      align: 'right'
			        },
			        {
			          header: '마지막점검일',
			          name: 'dates',
				      sortable: true,
				      align: 'center'
			        },
			        {
			          header: '설비상태',
			          name: 'sts',
				      align: 'center',
				      filter: {
				    	  type: 'select'
				      }
			        }
			      ]
			});
			
			return selectEqpGrid;
		}
		
		
		
		/* ---------------
		관리탭 설비목록 모달 grid 초기화
		--------------- */
		function eqpListModalInit() {
			let eqpListModalGrid = new tui.Grid({
				el: document.getElementById('eqpListModalGrid'),
				bodyHeight: 150,
				data: [{
					code: 'eqpCode-001',
					name: '만두 배합',
					proName: '혼합'
				},
				{
					code: 'eqpCode-002',
					name: '만두 성형',
					proName: '성형'
				}],
				rowHeaders: ['rowNum'],
				scrollX: false,
				scrollY: true,
				columns: [{
			          header: '설비코드',
			          name: 'code',
			          align: 'center'
			        },
			        {
			          header: '설비명',
			          name: 'name'
			        },
			        {
			          header: '공정명',
			          name: 'proName'
				    }
		      ] 
			});
			
			return eqpListModalGrid;
		}
		
		
		
		/* ---------------
		관리탭 설비구분 모달 grid 초기화
		--------------- */
		function eqpTypeModalInit() {
			let eqpTypeModalGrid = new tui.Grid({
				el: document.getElementById('eqpTypeModalGrid'),
				bodyHeight: 150,
				data: [{
					code: 'eqptype-01',
					name: '만두 배합'
				},
				{
					code: 'eqptype-02',
					name: '만두 성형',
				}],
				rowHeaders: ['rowNum'],
				scrollX: false,
				scrollY: true,
				columns: [{
			          header: '설비구분코드',
			          name: 'code',
			          align: 'center'
			        },
			        {
			          header: '설비구분명',
			          name: 'name'
			        },
		      ] 
			});
			
			return eqpTypeModalGrid;
		}
		
		
		
		/* ---------------
		조회탭 검색 버튼
		--------------- */
		function searchBtn() {
			
			document.getElementById('searchBtn').addEventListener('click', function () {
				let firstEName = document.getElementById('firstEName');
				
				// 검색창 글자 안 적으면 전체 조회 ajax
				if (firstEName.value == null || firstEName.value == '') {
					// ajax
					
					
					return;
				}
				
				// ajax로 검색어가 포함된 데이터 ajax로 가져오기
				
			})
		}
		
		
		
		/* ---------------
		조회탭 체크 삭제 버튼
		--------------- */
		function deleteBtn() {
			document.getElementById('deleteBtn').addEventListener('click', function () {
				let showConfirm = true;
				selectEqpGrid.removeCheckedRows(showConfirm);
			});
			
		}
		
		
		
		
		/* ---------------
		관리탭 설비목록 모달 조회
		--------------- */
		function eqpListSelect() {
			
			document.addEventListener('shown.bs.modal', function (){
				eqpListModalGrid.refreshLayout();
			});
			/* 
				팝업창띄우고
				설비 목록들 가져와서 띄워주고
				선택하면 input태그들에 데이터 들어가게
			*/
		}
		
		
		
		/* ---------------
		관리탭 설비목록 모달에서 하나 클릭시, 설비전체 input태그에 값 넣어주고 모달창 닫기
		--------------- */
		function eqpListInsertInput() {
			eqpListModalGrid.on('click',function(ev){
				
				let data = eqpListModalGrid.getRow(ev.rowKey);
				let eqpListCode = data.code; // 선택된 설비 구분 코드
				
				
				// 해당 코드 가지고 ajax로 설비 정보 다 불러와서 input태그들에 다 넣어주기.
				
				// document.getElementById('eqpTypeCode').value = eqpTypeCode;
				// document.getElementById('eqpTypeName').value = eqpTypeName;
				
				document.querySelector('#eqpListModal button.btn-close').click();
			});	
		}
		
		
		
		/* ---------------
		관리탭 설비구분 모달 시 refresh
		--------------- */
		
		function eqpTypeSelect() {
			document.addEventListener('shown.bs.modal', function (){
				eqpTypeModalGrid.refreshLayout();
			});
		}
		
		
		
		/* ---------------
		관리탭 설비구분 돋보기 모달에서 하나 클릭시, 설비구분 input태그에 값 넣어주고 모달창 닫기
		--------------- */
		function eqpTypeInsertInput() {
			eqpTypeModalGrid.on('click',function(ev){
				
				let data = eqpTypeModalGrid.getRow(ev.rowKey);
				let eqpTypeCode = data.code; // 선택된 설비 구분 코드
				let eqpTypeName = data.name; // 선택된 설비 구분명
				
				document.getElementById('eqpTypeCode').value = eqpTypeCode;
				document.getElementById('eqpTypeName').value = eqpTypeName;
				
				document.querySelector('#eqpTypeModal button.btn-close').click();
			});
		}
		
		
		
		/* ---------------
		관리탭 form태그 내용으로 insert OR update 하는 버튼
		--------------- */
		function insertUpdateBtn() {
			
			document.getElementById('insertUpdateBtn').addEventListener('click', function () {
				
			});
			/* 
				저장 누르면 정보 들고 db 가서
				서비스 단에서 해당 정보로 설비코드로 설비 검색해와서 없으면 insert시키고
				이미 있어서 정보를 return해주면 가져온 정보로 update
	
				insert든 update든 완료되면 알림 띄워주고
				화면단에 적힌거 reset버튼 타겟팅 후 click으로 지워준다.
			*/
		}
		
		
		

	</script>
</div>